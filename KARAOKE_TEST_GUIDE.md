# 🎤 清唱评分功能测试指南

## 📋 测试步骤

### 1. 打开应用
- 访问 http://localhost:8080
- 确保浏览器允许麦克风权限

### 2. 生成歌曲
1. 在首页输入歌曲主题（如："爱情"、"友谊"等）
2. 选择方言（普通话、粤语、四川话等）
3. 点击"生成歌词"按钮
4. 等待AI生成歌词
5. 点击"生成音乐"按钮
6. 等待AI生成音乐

### 3. 测试清唱评分功能
1. 在播放页面，点击"开始跟唱"按钮
2. 允许麦克风权限（如果弹出提示）
3. 点击"开始自由清唱"按钮
4. 对着麦克风清唱（任意时长都可以）
5. 点击"停止并评分"按钮
6. 查看评分结果

## 🔍 调试信息查看

### 打开浏览器开发者工具
1. 按 F12 或右键选择"检查"
2. 切换到"Console"标签页
3. 进行清唱测试
4. 观察控制台输出的调试信息

### 预期的调试日志
```
🎤 [DEBUG] 开始请求麦克风权限...
✅ [DEBUG] 麦克风权限获取成功
🎙️ [DEBUG] 开始录音函数被调用
🔐 [DEBUG] 权限状态: true
🎤 [DEBUG] 正在获取麦克风流...
✅ [DEBUG] 麦克风流获取成功
🔧 [DEBUG] 创建音频上下文...
🔧 [DEBUG] 音频上下文状态: running
✅ [DEBUG] 音频分析器设置完成
📊 [DEBUG] 开始实时音频分析
🔧 [DEBUG] 分析缓冲区大小: 1024
📈 [DEBUG] 分析数据 #50 - 音量: 25.30, 音高: 440.50Hz, 数据点总数: 50
🎯 [DEBUG] 开始分析录音并计算得分
⏱️ [DEBUG] 录音时长: 3.25 秒
📊 [DEBUG] 分析数据点数量: 162
🔍 [DEBUG] 开始纯人声录音分析...
📊 [DEBUG] 分析结果: {baseScore: 75, pitchScore: 20, ...}
🎵 [DEBUG] 短录音策略 - 基础分×0.8 + 奖励:20, 计算结果: 80.00
🎯 [DEBUG] 最终得分计算 - 原始分: 80.00 调整后: 80.00
🏆 [DEBUG] 最终评分对象: {totalScore: 80, pitchAccuracy: 20, ...}
📤 [DEBUG] 调用评分回调函数...
✅ [DEBUG] 评分计算完成并已回调
```

## 🧪 不同时长测试

### 测试场景
1. **超短录音** (0-1秒): 应该得到基础分60分
2. **极短录音** (1-2秒): 应该得到基础分70分
3. **短录音** (2-5秒): 应该得到基础评分×0.8 + 20分
4. **中等录音** (5-10秒): 应该得到基础评分×0.9 + 10分
5. **长录音** (10秒以上): 应该得到标准评分 + 15分

### 预期结果
- 所有时长的录音都应该能够获得评分
- 评分范围在40-100分之间
- 会显示鼓励性的反馈消息
- 实时得分会在录音过程中更新

## ❗ 常见问题排查

### 1. 没有麦克风权限
- 检查浏览器地址栏是否有麦克风图标
- 点击图标允许麦克风访问
- 刷新页面重试

### 2. 录音没有声音
- 检查麦克风是否正常工作
- 尝试在其他应用中测试麦克风
- 检查系统音量设置

### 3. 评分不准确
- 确保在安静环境中测试
- 尽量清晰地发声
- 检查控制台是否有错误信息

### 4. 页面崩溃或卡死
- 刷新页面重试
- 检查控制台错误信息
- 确保浏览器支持Web Audio API

## 🎯 成功标准

✅ 能够获取麦克风权限  
✅ 能够开始录音  
✅ 实时音频分析正常工作  
✅ 任意时长录音都能获得评分  
✅ 评分结果合理（40-100分）  
✅ 显示鼓励性反馈消息  
✅ 控制台显示完整的调试日志  

---

**注意**: 如果遇到问题，请查看浏览器控制台的调试日志，这些日志会帮助定位具体问题所在。